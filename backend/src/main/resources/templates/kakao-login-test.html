<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ - Voin</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .login-section {
        text-align: center;
        margin: 30px 0;
      }
      .kakao-login-btn {
        cursor: pointer;
        transition: transform 0.2s;
      }
      .kakao-login-btn:hover {
        transform: scale(1.05);
      }
      .result-section {
        margin-top: 30px;
        padding: 20px;
        background-color: #f8f9fa;
        border-radius: 5px;
      }
      .token-info,
      .user-info {
        margin: 15px 0;
        padding: 10px;
        background-color: #e9ecef;
        border-radius: 5px;
        font-family: monospace;
        font-size: 12px;
        word-break: break-all;
      }
      .success {
        color: #28a745;
      }
      .error {
        color: #dc3545;
      }
    </style>
    <!-- ì¹´ì¹´ì˜¤ JavaScript SDK ë¡œë“œ -->
    <script
      src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="container">
      <h1>ğŸƒ Voin ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</h1>

      <div class="login-section">
        <p>ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”!</p>
        <!-- ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼ -->
        <img
          src="https://k.kakaocdn.net/14/dn/btroDszwNrM/I6efHub1SN5KCJqLm1Ovx1/o.jpg"
          width="222"
          alt="ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼"
          class="kakao-login-btn"
          onclick="loginWithKakao()"
        />
      </div>

      <div class="result-section">
        <h3>ğŸ“‹ í…ŒìŠ¤íŠ¸ ê²°ê³¼</h3>
        <div id="status">ë¡œê·¸ì¸ ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”.</div>
        <div id="token-result" class="token-info" style="display: none"></div>
        <div id="user-info" class="user-info" style="display: none"></div>
      </div>
    </div>

    <script>
      // ì¹´ì¹´ì˜¤ SDK ì´ˆê¸°í™” (ì¹´ì¹´ì˜¤ ì•±ì˜ JavaScript í‚¤ ì‚¬ìš©)
      Kakao.init("2ac62bc43a0718bcd65126b5dbae3843");
      console.log("ì¹´ì¹´ì˜¤ SDK ì´ˆê¸°í™” ìƒíƒœ:", Kakao.isInitialized());

      function updateStatus(message, isError = false) {
        const statusElement = document.getElementById("status");
        statusElement.innerHTML = message;
        statusElement.className = isError ? "error" : "success";
      }

      function loginWithKakao() {
        updateStatus("ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...");

        Kakao.Auth.authorize({
          // ì´ ì£¼ì†ŒëŠ” ì¹´ì¹´ì˜¤ ë””ë²¨ë¡œí¼ìŠ¤ì— ë“±ë¡ëœ Redirect URIì™€ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.
          redirectUri: "http://localhost:8080/auth/kakao/callback",
        });
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ URLì—ì„œ íŒŒë¼ë¯¸í„°ë¥¼ í™•ì¸í•˜ì—¬ ë°±ì—”ë“œ ê²°ê³¼ í‘œì‹œ
      window.onload = function () {
        const urlParams = new URLSearchParams(window.location.search);
        const accessToken = urlParams.get("access_token");
        const isNewMember = urlParams.get("is_new_member");
        const error = urlParams.get("error");

        if (accessToken) {
          // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ë°±ì—”ë“œì—ì„œ ë°›ì€ JWT í† í° í‘œì‹œ
          updateStatus("âœ… ë¡œê·¸ì¸ ì„±ê³µ! JWT í† í°ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.");
          const tokenElement = document.getElementById("token-result");
          tokenElement.innerHTML = `<strong>JWT í† í°:</strong><br>${accessToken}`;
          tokenElement.style.display = "block";

          const userInfoElement = document.getElementById("user-info");
          const nickname = urlParams.get("nickname");
          userInfoElement.innerHTML = `
                    <strong>ğŸ¯ ë¡œê·¸ì¸ ê²°ê³¼:</strong><br>
                    ğŸ“ ì²˜ë¦¬ ìœ í˜•: <span class="success">Login</span><br>
                    ğŸ·ï¸ ë‹‰ë„¤ì„: ${
                      nickname ? decodeURIComponent(nickname) : "ì •ë³´ ì—†ìŒ"
                    }<br>
                    ğŸ« JWT í† í°: ë°œê¸‰ ì™„ë£Œ
                `;
          userInfoElement.style.display = "block";
        } else if (isNewMember === "true") {
          // ì‹ ê·œ íšŒì›ì¼ ê²½ìš°
          const kakaoAccessToken = urlParams.get("kakao_access_token");
          updateStatus("ğŸš€ ì‹ ê·œ íšŒì›ì´ì‹œë„¤ìš”! íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
          const tokenElement = document.getElementById("token-result");
          tokenElement.innerHTML = `<strong>íšŒì›ê°€ì…ìš© ì¹´ì¹´ì˜¤ í† í°:</strong><br>${kakaoAccessToken}`;
          tokenElement.style.display = "block";

          const userInfoElement = document.getElementById("user-info");
          userInfoElement.innerHTML = `
                    <strong>ğŸ¯ íšŒì›ê°€ì… ê²°ê³¼:</strong><br>
                    ğŸ“ ì²˜ë¦¬ ìœ í˜•: <span class="success">Signup</span><br>
                    ğŸ‰ ìƒíƒœ: íšŒì›ê°€ì… ì™„ë£Œ<br>
                    ğŸ« JWT í† í°: ë°œê¸‰ ì™„ë£Œ
                `;
          userInfoElement.style.display = "block";
        } else if (error) {
          // ì—ëŸ¬ ë°œìƒ ì‹œ
          const message = urlParams.get("message");
          updateStatus(
            `âŒ ì˜¤ë¥˜ ë°œìƒ: ${decodeURIComponent(message || "Unknown error")}`,
            true
          );
        }
      };

      // ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í•¨ìˆ˜ (ê¸°ì¡´ ì½”ë“œì™€ì˜ í˜¸í™˜ì„±ì„ ìœ„í•´ ë‚¨ê²¨ë‘ )
      async function checkUserWithBackend(accessToken) {
        // ì´ í•¨ìˆ˜ëŠ” ì´ì œ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
        // ëª¨ë“  ì²˜ë¦¬ëŠ” ë°±ì—”ë“œì˜ /auth/kakao/callbackì—ì„œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.
        console.log("ì´ í•¨ìˆ˜ëŠ” ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      }
    </script>
  </body>
</html>
