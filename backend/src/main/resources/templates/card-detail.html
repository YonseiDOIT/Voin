<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ïπ¥Îìú ÏÉÅÏÑ∏ Î≥¥Í∏∞</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        margin: 0;
        background-color: #f4f4f9;
        color: #333;
      }
      header {
        background-color: #fff;
        padding: 20px;
        text-align: center;
        border-bottom: 1px solid #ddd;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        position: relative;
      }
      h1 {
        margin: 0;
        font-size: 28px;
        color: #333;
      }
      .back-btn {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        background-color: #6c757d;
        color: white;
        padding: 8px 16px;
        text-decoration: none;
        border-radius: 6px;
        font-size: 14px;
        transition: background-color 0.2s;
      }
      .back-btn:hover {
        background-color: #5a6268;
      }
      main {
        padding: 30px 20px;
        max-width: 800px;
        margin: 0 auto;
      }
      .card-detail {
        background-color: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 40px;
        margin-bottom: 20px;
      }
      .card-header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #f0f0f0;
      }
      .coin-badge {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: bold;
        display: inline-block;
        margin-bottom: 10px;
      }
      .keyword-title {
        font-size: 32px;
        font-weight: bold;
        color: #333;
        margin: 10px 0;
      }
      .keyword-description {
        font-size: 16px;
        color: #666;
        margin-bottom: 20px;
      }
      .content-section {
        margin-top: 30px;
      }
      .content-title {
        font-size: 20px;
        font-weight: bold;
        color: #333;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
      }
      .content-title::before {
        content: "üìù";
        margin-right: 10px;
        font-size: 24px;
      }
      .content-text {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        border-left: 4px solid #007bff;
        font-size: 16px;
        line-height: 1.6;
        white-space: pre-wrap;
      }
      .card-meta {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 10px;
      }
      .meta-item {
        color: #666;
        font-size: 14px;
      }
      .meta-label {
        font-weight: bold;
        color: #333;
      }
      #loading {
        text-align: center;
        padding: 80px 20px;
        font-size: 18px;
        color: #666;
      }
      .error-state {
        text-align: center;
        padding: 80px 20px;
        color: #666;
      }
      .error-state h2 {
        font-size: 24px;
        margin-bottom: 12px;
        color: #dc3545;
      }
      .error-state .btn {
        display: inline-block;
        background-color: #6c757d;
        color: white;
        padding: 12px 24px;
        text-decoration: none;
        border-radius: 8px;
        font-size: 16px;
        transition: background-color 0.2s;
      }
      .error-state .btn:hover {
        background-color: #5a6268;
      }
    </style>
  </head>
  <body>
    <header>
      <a href="/cards" class="back-btn">‚Üê Î™©Î°ùÏúºÎ°ú</a>
      <h1>ü™ô Ïπ¥Îìú ÏÉÅÏÑ∏ Î≥¥Í∏∞</h1>
    </header>
    <main>
      <div id="loading">Ïπ¥Îìú Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
      <div id="card-content" style="display: none">
        <!-- Ïπ¥Îìú ÏÉÅÏÑ∏ ÎÇ¥Ïö©Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
      </div>
    </main>

    <script th:inline="javascript">
      document.addEventListener("DOMContentLoaded", function () {
        const cardId = /*[[${cardId}]]*/ null;

        if (!cardId) {
          showError("Ïπ¥Îìú IDÍ∞Ä Ïú†Ìö®ÌïòÏßÄ ÏïäÏäµÎãàÎã§.");
          return;
        }

        fetch(`/api/cards/${cardId}`)
          .then((response) => {
            if (!response.ok) {
              throw new Error("Ïπ¥Îìú Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.");
            }
            return response.json();
          })
          .then((card) => {
            const loadingDiv = document.getElementById("loading");
            const contentDiv = document.getElementById("card-content");

            loadingDiv.style.display = "none";
            contentDiv.style.display = "block";

            // Ïπ¥Îìú Ï†ïÎ≥¥ ÌëúÏãú
            displayCard(card);
          })
          .catch((error) => {
            console.error("Error fetching card:", error);
            showError(error.message);
          });
      });

      function displayCard(card) {
        const contentDiv = document.getElementById("card-content");

        const coinName =
          card.keyword && card.keyword.coin ? card.keyword.coin.name : "ÎØ∏Î∂ÑÎ•ò";
        const coinColor =
          card.keyword && card.keyword.coin
            ? card.keyword.coin.color
            : "#667eea";
        const keywordName = card.keyword ? card.keyword.name : "ÌÇ§ÏõåÎìú ÏóÜÏùå";
        const keywordDescription = card.keyword ? card.keyword.description : "";
        const content = card.content || "ÎÇ¥Ïö©Ïù¥ ÏóÜÏäµÎãàÎã§.";

        // ÎÇ†Ïßú Ìè¨Îß∑ÌåÖ
        let formattedDate = "";
        if (card.createdAt) {
          const date = new Date(card.createdAt);
          formattedDate = date.toLocaleDateString("ko-KR", {
            year: "numeric",
            month: "long",
            day: "numeric",
            hour: "2-digit",
            minute: "2-digit",
          });
        }

        contentDiv.innerHTML = `
          <div class="card-detail">
            <div class="card-header">
              <div class="coin-badge" style="background: linear-gradient(135deg, ${coinColor}, ${adjustBrightness(
          coinColor,
          -20
        )});">
                ${coinName}
              </div>
              <div class="keyword-title">üíé ${keywordName}</div>
              ${
                keywordDescription
                  ? `<div class="keyword-description">${keywordDescription}</div>`
                  : ""
              }
            </div>
            
            <div class="content-section">
              <div class="content-title">ÎÇ¥Í∞Ä Í∏∞Î°ùÌïú Ïù¥ÏïºÍ∏∞</div>
              <div class="content-text">${content}</div>
            </div>
            
            <div class="card-meta">
              <div class="meta-item">
                <span class="meta-label">ÏÉùÏÑ±Ïùº:</span> ${
                  formattedDate || "Ï†ïÎ≥¥ ÏóÜÏùå"
                }
              </div>
              <div class="meta-item">
                <span class="meta-label">Ïπ¥Îìú ID:</span> #${card.id}
              </div>
              <div class="meta-item">
                <span class="meta-label">Í≥µÍ∞ú Ïó¨Î∂Ä:</span> ${
                  card.isPublic ? "Í≥µÍ∞ú" : "ÎπÑÍ≥µÍ∞ú"
                }
              </div>
            </div>
          </div>
        `;
      }

      function showError(message) {
        const loadingDiv = document.getElementById("loading");
        loadingDiv.innerHTML = `
          <div class="error-state">
            <h2>‚ö†Ô∏è Ïò§Î•ò Î∞úÏÉù</h2>
            <p>${message}</p>
            <a href="/cards" class="btn">Î™©Î°ùÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</a>
          </div>
        `;
      }

      // ÏÉâÏÉÅ Î∞ùÍ∏∞ Ï°∞Ï†à Ìï®Ïàò
      function adjustBrightness(hex, percent) {
        const num = parseInt(hex.replace("#", ""), 16);
        const amt = Math.round(2.55 * percent);
        const R = (num >> 16) + amt;
        const G = ((num >> 8) & 0x00ff) + amt;
        const B = (num & 0x0000ff) + amt;
        return (
          "#" +
          (
            0x1000000 +
            (R < 255 ? (R < 1 ? 0 : R) : 255) * 0x10000 +
            (G < 255 ? (G < 1 ? 0 : G) : 255) * 0x100 +
            (B < 255 ? (B < 1 ? 0 : B) : 255)
          )
            .toString(16)
            .slice(1)
        );
      }
    </script>
  </body>
</html>
