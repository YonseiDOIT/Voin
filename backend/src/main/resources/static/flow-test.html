<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voin - ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        color: #333;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2em;
        margin-bottom: 10px;
      }

      .header p {
        opacity: 0.9;
      }

      .content {
        padding: 30px;
      }

      .step {
        display: none;
        animation: fadeIn 0.3s ease;
      }

      .step.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .step-title {
        font-size: 1.8em;
        margin-bottom: 20px;
        color: #333;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .step-number {
        background: #667eea;
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9em;
        font-weight: bold;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 12px 24px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 5px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
      }

      .btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .btn.kakao {
        background: #fee500;
        color: #000000;
      }

      .btn.secondary {
        background: #6c757d;
      }

      .btn.secondary:hover {
        background: #5a6268;
        box-shadow: 0 8px 16px rgba(108, 117, 125, 0.3);
      }

      .btn-group {
        display: flex;
        gap: 10px;
        justify-content: center;
        align-items: center;
        margin-top: 20px;
      }

      .input-group {
        margin: 15px 0;
      }

      .input-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #333;
      }

      .input-group input,
      .input-group textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .input-group input:focus,
      .input-group textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .card {
        border: 2px solid #eee;
        border-radius: 12px;
        padding: 20px;
        background: white;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .card:hover {
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .card.selected {
        border-color: #667eea;
        background: #f0f4ff;
      }

      .card h3 {
        color: #333;
        margin-bottom: 10px;
      }

      .card p {
        color: #666;
        font-size: 14px;
        line-height: 1.5;
      }

      .keyword-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin: 20px 0;
      }

      .keyword-tag {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .keyword-tag:hover {
        background: #e9ecef;
      }

      .keyword-tag.selected {
        background: #667eea;
        color: white;
        border-color: #667eea;
      }

      .status {
        margin: 20px 0;
        padding: 15px;
        border-radius: 8px;
        background: #f8f9fa;
        border-left: 4px solid #667eea;
      }

      .status.success {
        background: #d1edda;
        border-left-color: #28a745;
        color: #155724;
      }

      .status.error {
        background: #f8d7da;
        border-left-color: #dc3545;
        color: #721c24;
      }

      .navigation {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #eee;
      }

      .progress-bar {
        background: #f8f9fa;
        height: 8px;
        border-radius: 4px;
        margin: 20px 0;
        overflow: hidden;
      }

      .progress-fill {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        height: 100%;
        border-radius: 4px;
        transition: width 0.3s ease;
        width: 0%;
      }

      .coin-selection {
        margin: 20px 0;
      }

      .coin-category {
        margin-bottom: 30px;
      }

      .coin-category h3 {
        color: #333;
        margin-bottom: 15px;
        padding-bottom: 5px;
        border-bottom: 2px solid #667eea;
      }

      /* ìƒˆë¡œìš´ ì½”ì¸ ì„ íƒ UI ìŠ¤íƒ€ì¼ */
      .categories {
        display: flex;
        gap: 8px;
        margin-bottom: 24px;
        flex-wrap: wrap;
      }

      .category-btn {
        padding: 8px 16px;
        border-radius: 20px;
        border: 1px solid #ddd;
        background-color: #f5f5f5;
        color: #555;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 14px;
      }

      .category-btn:hover {
        border-color: #667eea;
        background-color: #f0f4ff;
      }

      .category-btn.selected {
        background-color: #667eea;
        color: white;
        border-color: #667eea;
      }

      .keyword-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
      }

      .keyword-card {
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 12px;
        padding: 24px 16px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        font-size: 14px;
        min-height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .keyword-card:hover {
        border-color: #667eea;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
      }

      .keyword-card.selected {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border-color: #667eea;
      }

      .keyword-card.selected::before {
        content: "âœ“ ";
        margin-right: 4px;
      }

      .summary-box {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin: 24px 0;
        text-align: left;
        border: 1px solid #e9ecef;
      }

      .summary-box p {
        margin: 8px 0;
        line-height: 1.5;
      }

      .summary-box strong {
        color: #495057;
      }

      .final-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 15px;
        margin: 20px 0;
        text-align: center;
      }

      .final-card h2 {
        margin-bottom: 20px;
      }

      .selected-items {
        background: white;
        color: #333;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸª™ VOIN ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸</h1>
        <p>ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ë¶€í„° ì¹´ë“œ ìƒì„±ê¹Œì§€ ì „ì²´ ê³¼ì •ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”</p>
      </div>

      <div class="content">
        <!-- ì§„í–‰ë¥  í‘œì‹œ -->
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>

        <!-- 1ë‹¨ê³„: ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ -->
        <div class="step active" id="loginStep">
          <div class="step-title">
            <span class="step-number">1</span>
            ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸
          </div>
          <p style="margin-bottom: 20px">
            ë¨¼ì € ì¹´ì¹´ì˜¤ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.
          </p>
          <button class="btn kakao" onclick="startKakaoLogin()">
            ğŸ¯ ì¹´ì¹´ì˜¤ë¡œ ë¡œê·¸ì¸í•˜ê¸°
          </button>
          <div id="loginStatus" class="status" style="display: none"></div>
        </div>

        <!-- 2ë‹¨ê³„: ë‹‰ë„¤ì„ ì„¤ì • (ì‹ ê·œ íšŒì›ë§Œ) -->
        <div class="step" id="nicknameStep">
          <div class="step-title">
            <span class="step-number">2</span>
            ë‹‰ë„¤ì„ ì„¤ì •
          </div>
          <p style="margin-bottom: 20px">ì‚¬ìš©í•˜ì‹¤ ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
          <div class="input-group">
            <label for="nickname">ë‹‰ë„¤ì„</label>
            <input
              type="text"
              id="nickname"
              placeholder="2-10ìì˜ ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”"
              maxlength="10"
            />
          </div>
          <div class="btn-group" style="margin-top: 20px">
            <button
              class="btn secondary"
              onclick="goToPreviousStep('nicknameStep')"
            >
              ì´ì „
            </button>
            <button class="btn" onclick="setNickname()">ë‹¤ìŒ ë‹¨ê³„</button>
          </div>
          <div id="nicknameStatus" class="status" style="display: none"></div>
        </div>

        <!-- 3ë‹¨ê³„: í”„ë¡œí•„ ì´ë¯¸ì§€ ì„¤ì • (ì‹ ê·œ íšŒì›ë§Œ) -->
        <div class="step" id="profileStep">
          <div class="step-title">
            <span class="step-number">3</span>
            í”„ë¡œí•„ ì´ë¯¸ì§€ ì„¤ì •
          </div>
          <p style="margin-bottom: 20px">í”„ë¡œí•„ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
          <div class="card-grid" id="profileImages">
            <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ ì˜µì…˜ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
          </div>
          <div class="btn-group" style="margin-top: 20px">
            <button
              class="btn secondary"
              onclick="goToPreviousStep('profileStep')"
            >
              ì´ì „
            </button>
            <button
              class="btn"
              onclick="setProfileImage()"
              id="profileBtn"
              disabled
            >
              ë‹¤ìŒ ë‹¨ê³„
            </button>
          </div>
          <div id="profileStatus" class="status" style="display: none"></div>
        </div>

        <!-- 4ë‹¨ê³„: ì½”ì¸ ì°¾ê¸° ìœ í˜• ì„ íƒ -->
        <div class="step" id="coinFinderStep">
          <div class="step-title">
            <span class="step-number">4</span>
            ì½”ì¸ ì°¾ê¸° ìœ í˜• ì„ íƒ
          </div>
          <p style="margin-bottom: 20px">ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì¥ì ì„ ì°¾ì•„ë³¼ê¹Œìš”?</p>
          <div class="card-grid" id="finderTypes">
            <!-- ì½”ì¸ ì°¾ê¸° ìœ í˜•ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
          </div>
          <div id="finderStatus" class="status" style="display: none"></div>
        </div>

        <!-- 5ë‹¨ê³„: ì˜¤ëŠ˜ì˜ ì¼ê¸° ì‘ì„± -->
        <div class="step" id="diaryStep">
          <div class="step-title">
            <span class="step-number">5</span>
            ì˜¤ëŠ˜ì˜ ì¼ê¸° ì‘ì„±
          </div>
          <p style="margin-bottom: 20px">
            ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ëŒì•„ë³´ë©° ì¼ê¸°ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”.
          </p>
          <div class="input-group">
            <label for="diaryContent">ì˜¤ëŠ˜ì˜ ì¼ê¸°</label>
            <textarea
              id="diaryContent"
              rows="6"
              placeholder="ì˜¤ëŠ˜ í•˜ë£¨ ì–´ë–¤ ì¼ì´ ìˆì—ˆë‚˜ìš”? ì–´ë–¤ ê¸°ë¶„ì´ì—ˆë‚˜ìš”?"
            ></textarea>
          </div>
          <div class="btn-group" style="margin-top: 20px">
            <button
              class="btn secondary"
              onclick="goToPreviousStep('diaryStep')"
            >
              ì´ì „
            </button>
            <button class="btn" onclick="saveDiary()">
              ì¼ê¸° ì €ì¥í•˜ê³  ë‹¤ìŒ ë‹¨ê³„
            </button>
          </div>
          <div id="diaryStatus" class="status" style="display: none"></div>
        </div>

        <!-- 6ë‹¨ê³„: ì½”ì¸ ì„ íƒ -->
        <div class="step" id="coinSelectionStep">
          <div class="step-title">
            <span class="step-number">6</span>
            ì½”ì¸ ì„ íƒ
          </div>
          <p style="margin-bottom: 20px">ë‚˜ì—ê²Œ ë§ëŠ” ì½”ì¸ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
          <div class="coin-selection" id="coinOptions">
            <!-- ì½”ì¸ ì˜µì…˜ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
          </div>
          <div class="btn-group" style="margin-top: 20px">
            <button
              class="btn secondary"
              onclick="goToPreviousStep('coinSelectionStep')"
            >
              ì´ì „
            </button>
          </div>
          <div
            id="coinSelectionStatus"
            class="status"
            style="display: none"
          ></div>
        </div>

        <!-- 7ë‹¨ê³„: í‚¤ì›Œë“œ ì„ íƒ -->
        <div class="step" id="keywordSelectionStep">
          <div class="step-title">
            <span class="step-number">7</span>
            í‚¤ì›Œë“œ ì„ íƒ
          </div>
          <p style="margin-bottom: 20px">
            ì„ íƒí•œ ì½”ì¸ì— ë§ëŠ” í‚¤ì›Œë“œë¥¼ 3ê°œê¹Œì§€ ì„ íƒí•´ì£¼ì„¸ìš”.
          </p>
          <div class="keyword-grid" id="keywordOptions">
            <!-- í‚¤ì›Œë“œ ì˜µì…˜ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
          </div>
          <div class="btn-group" style="margin-top: 20px">
            <button
              class="btn secondary"
              onclick="goToPreviousStep('keywordSelectionStep')"
            >
              ì´ì „
            </button>
            <button
              class="btn"
              onclick="createCard()"
              id="createCardBtn"
              disabled
            >
              ì¹´ë“œ ìƒì„±í•˜ê¸°
            </button>
          </div>
          <div id="keywordStatus" class="status" style="display: none"></div>
        </div>

        <!-- 8ë‹¨ê³„: ì™„ë£Œ -->
        <div class="step" id="completeStep">
          <div class="step-title">
            <span class="step-number">8</span>
            ì¹´ë“œ ìƒì„± ì™„ë£Œ!
          </div>
          <div class="final-card">
            <h2>ğŸ‰ ì¥ì  ì¹´ë“œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
            <div class="selected-items" id="finalCardInfo">
              <!-- ìƒì„±ëœ ì¹´ë“œ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
          </div>
          <div class="navigation">
            <button class="btn secondary" onclick="goHome()">
              í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>
            <button class="btn" onclick="restart()">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
          </div>
        </div>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="navigation" id="navigation" style="display: none">
          <button class="btn secondary" onclick="previousStep()" id="prevBtn">
            ì´ì „ ë‹¨ê³„
          </button>
          <button class="btn" onclick="nextStep()" id="nextBtn">
            ë‹¤ìŒ ë‹¨ê³„
          </button>
        </div>
      </div>
    </div>

    <script>
      // ì „ì—­ ìƒíƒœ ê´€ë¦¬
      const state = {
        currentStep: 1,
        totalSteps: 8,
        accessToken: null,
        jwtToken: null,
        memberId: null,
        isNewMember: false,
        selectedFinderType: null,
        formId: null,
        selectedCoin: null,
        selectedKeyword: null,
        selectedKeywords: new Set(),
        createdCard: null,
        selectedProfileImage: null,
        coinsWithKeywords: [],
        diaryEntry: null,
        fromExperience: false, // ì‚¬ë¡€ ëŒì•„ë³´ê¸°ì—ì„œ ì˜¨ ê²½ìš° í‘œì‹œ
      };

      // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
      function updateProgress() {
        const progress = (state.currentStep / state.totalSteps) * 100;
        document.getElementById("progressFill").style.width = progress + "%";
      }

      // ë‹¨ê³„ í‘œì‹œ
      function showStep(stepId) {
        document
          .querySelectorAll(".step")
          .forEach((step) => step.classList.remove("active"));
        document.getElementById(stepId).classList.add("active");

        const stepNumber = {
          loginStep: 1,
          nicknameStep: 2,
          profileStep: 3,
          coinFinderStep: 4,
          diaryStep: 5,
          coinSelectionStep: 6,
          keywordSelectionStep: 7,
          completeStep: 8,
        };

        state.currentStep = stepNumber[stepId] || 1;
        updateProgress();
      }

      // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
      function showStatus(elementId, message, isError = false) {
        const element = document.getElementById(elementId);
        element.style.display = "block";
        element.textContent = message;
        element.className = `status ${isError ? "error" : "success"}`;
      }

      // ì´ì „ ë‹¨ê³„ë¡œ ê°€ê¸°
      function goToPreviousStep(currentStep) {
        const stepFlow = {
          nicknameStep: "loginStep",
          profileStep: "nicknameStep",
          coinFinderStep: state.isNewMember ? "profileStep" : "loginStep",
          diaryStep: "coinFinderStep",
          coinSelectionStep: "diaryStep",
          keywordSelectionStep: "coinSelectionStep",
        };

        const previousStep = stepFlow[currentStep];
        if (previousStep) {
          showStep(previousStep);

          // íŠ¹ë³„í•œ ì²˜ë¦¬ê°€ í•„ìš”í•œ ê²½ìš°
          if (previousStep === "coinFinderStep") {
            loadFinderTypes();
          } else if (previousStep === "profileStep") {
            loadProfileImages();
          }
        }
      }

      // ë¡œë”© ìƒíƒœ í‘œì‹œ
      function showLoading(elementId, message = "ì²˜ë¦¬ ì¤‘...") {
        const element = document.getElementById(elementId);
        element.style.display = "block";
        element.innerHTML = `<span class="loading"></span> ${message}`;
        element.className = "status";
      }

      // 1. ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸
      async function startKakaoLogin() {
        showLoading("loginStatus", "ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™ ì¤‘...");

        try {
          // í”Œë¡œìš° í…ŒìŠ¤íŠ¸ì„ì„ ì•Œë¦¬ëŠ” íŒŒë¼ë¯¸í„°ì™€ í•¨ê»˜ ì¹´ì¹´ì˜¤ ì¸ì¦ URLì„ ê°€ì ¸ì˜´
          const response = await fetch("/auth/kakao/url?from_flow=true");
          const data = await response.json();

          if (data.success && data.data) {
            // ì‹¤ì œ ì¹´ì¹´ì˜¤ ì¸ì¦ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            window.location.href = data.data;
          } else {
            showStatus(
              "loginStatus",
              "ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ URLì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
              true
            );
          }
        } catch (error) {
          showStatus(
            "loginStatus",
            "ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì¤€ë¹„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
            true
          );
        }
      }

      // ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ê²°ê³¼ ì²˜ë¦¬ í•¨ìˆ˜
      function handleKakaoLoginResult(urlParams) {
        try {
          showStatus("loginStatus", "ë¡œê·¸ì¸ ì„±ê³µ! ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.");

          const accessToken = urlParams.get("access_token");
          const memberId = urlParams.get("member_id");
          const token = urlParams.get("token");
          const isNewMember = urlParams.get("is_new_member");
          const isExisting = urlParams.get("is_existing");

          // URL íŒŒë¼ë¯¸í„°ë¥¼ ì•ˆì „í•˜ê²Œ booleanìœ¼ë¡œ ë³€í™˜
          const isNewMemberBool = isNewMember === "true";
          const isExistingBool = isExisting === "true";

          console.log("Login result parameters:", {
            isNewMember,
            isExisting,
            isNewMemberBool,
            isExistingBool,
            accessToken,
            memberId,
            token,
            "accessToken length": accessToken ? accessToken.length : 0,
            "memberId type": typeof memberId,
            "token length": token ? token.length : 0,
          });

          if (isNewMemberBool) {
            // ì‹ ê·œ íšŒì›ì¸ ê²½ìš°
            console.log("Processing new member flow");
            state.isNewMember = true;
            state.accessToken = accessToken;
            console.log("New member flow - going to nickname step");
            setTimeout(() => {
              showStep("nicknameStep");
            }, 1000);
          } else if (isExistingBool) {
            // ê¸°ì¡´ íšŒì›ì¸ ê²½ìš°
            console.log("Processing existing member flow");
            state.isNewMember = false;
            state.memberId = memberId;
            state.jwtToken = token;

            console.log("Existing member flow", {
              skipToCoins: state.skipToCoins,
              fromExperience: state.fromExperience,
            });

            // ì‚¬ë¡€ ëŒì•„ë³´ê¸°ì—ì„œ ì˜¨ ê²½ìš° ë°”ë¡œ ì½”ì¸ ì„ íƒìœ¼ë¡œ ì´ë™
            if (state.skipToCoins && state.fromExperience) {
              console.log("Skipping to coins for experience flow");
              setTimeout(() => {
                loadCoins();
                showStep("coinSelectionStep");
              }, 1000);
            } else {
              // ì¼ë°˜ì ì¸ ê²½ìš° ì½”ì¸ ì°¾ê¸° ë‹¨ê³„ë¡œ ì´ë™
              console.log("Going to finder types step");
              setTimeout(() => {
                showStep("coinFinderStep");
                loadFinderTypes();
              }, 1000);
            }
          } else {
            // íŒŒë¼ë¯¸í„°ê°€ ì—†ëŠ” ê²½ìš°ì˜ ì²˜ë¦¬
            console.error("No valid login parameters found:", {
              isNewMember,
              isExisting,
              isNewMemberBool,
              isExistingBool,
            });
            showStatus(
              "loginStatus",
              "ë¡œê·¸ì¸ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒë¼ë¯¸í„°: isNewMember=" +
                isNewMember +
                ", isExisting=" +
                isExisting,
              true
            );
          }

          // URLì—ì„œ íŒŒë¼ë¯¸í„° ì œê±° (ë’¤ë¡œê°€ê¸° ë“±ì„ ìœ„í•´)
          window.history.replaceState(
            {},
            document.title,
            window.location.pathname
          );
        } catch (error) {
          console.error("Error in handleKakaoLoginResult:", error);
          showStatus(
            "loginStatus",
            "ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
            true
          );
        }
      }

      // 2. ë‹‰ë„¤ì„ ì„¤ì •
      async function setNickname() {
        const nickname = document.getElementById("nickname").value.trim();
        if (!nickname) {
          showStatus("nicknameStatus", "ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", true);
          return;
        }

        if (nickname.length < 2 || nickname.length > 10) {
          showStatus("nicknameStatus", "ë‹‰ë„¤ì„ì€ 2-10ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.", true);
          return;
        }

        showLoading("nicknameStatus", "ë‹‰ë„¤ì„ ì„¤ì • ì¤‘...");

        try {
          const response = await fetch("/signup/nickname", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              accessToken: state.accessToken,
              nickname: nickname,
            }),
          });

          const data = await response.json();
          if (data.success) {
            showStatus("nicknameStatus", "ë‹‰ë„¤ì„ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
            loadProfileImages();
            showStep("profileStep");
          } else {
            showStatus(
              "nicknameStatus",
              data.message || "ë‹‰ë„¤ì„ ì„¤ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
              true
            );
          }
        } catch (error) {
          showStatus("nicknameStatus", "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", true);
        }
      }

      // 3. í”„ë¡œí•„ ì´ë¯¸ì§€ ë¡œë“œ ë° ì„ íƒ
      function loadProfileImages() {
        const profileImages = [
          "https://via.placeholder.com/80/667eea/white?text=ğŸ˜Š",
          "https://via.placeholder.com/80/764ba2/white?text=ğŸ˜",
          "https://via.placeholder.com/80/f093fb/white?text=ğŸŒŸ",
          "https://via.placeholder.com/80/4facfe/white?text=ğŸš€",
          "https://via.placeholder.com/80/43e97b/white?text=ğŸ¯",
          "https://via.placeholder.com/80/f38ba8/white?text=ğŸ’",
        ];

        const container = document.getElementById("profileImages");
        container.innerHTML = "";

        profileImages.forEach((imageUrl, index) => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <img src="${imageUrl}" alt="í”„ë¡œí•„ ${
            index + 1
          }" style="width: 80px; height: 80px; margin: 0 auto; display: block; border-radius: 50%;">
            <p style="text-align: center; margin-top: 10px;">í”„ë¡œí•„ ${
              index + 1
            }</p>
          `;
          card.addEventListener("click", () =>
            selectProfileImage(imageUrl, card)
          );
          container.appendChild(card);
        });
      }

      function selectProfileImage(imageUrl, element) {
        document
          .querySelectorAll("#profileImages .card")
          .forEach((card) => card.classList.remove("selected"));
        element.classList.add("selected");
        state.selectedProfileImage = imageUrl;
        document.getElementById("profileBtn").disabled = false;
      }

      async function setProfileImage() {
        if (!state.selectedProfileImage) {
          showStatus("profileStatus", "í”„ë¡œí•„ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.", true);
          return;
        }

        showLoading("profileStatus", "í”„ë¡œí•„ ì´ë¯¸ì§€ ì„¤ì • ì¤‘...");

        try {
          const response = await fetch("/signup/profile-image", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              accessToken: state.accessToken,
              profileImage: state.selectedProfileImage,
            }),
          });

          const data = await response.json();
          if (data.success) {
            state.jwtToken = data.data.token || "temp_jwt_" + Date.now();
            showStatus("profileStatus", "í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");

            // ì‚¬ë¡€ ëŒì•„ë³´ê¸°ì—ì„œ ì˜¨ ê²½ìš° ë°”ë¡œ ì½”ì¸ ì„ íƒìœ¼ë¡œ ì´ë™
            if (state.skipToCoins && state.fromExperience) {
              loadCoins();
              showStep("coinSelectionStep");
            } else {
              // ì¼ë°˜ì ì¸ ê²½ìš° ì½”ì¸ ì°¾ê¸° ë‹¨ê³„ë¡œ ì´ë™
              loadFinderTypes();
              showStep("coinFinderStep");
            }
          } else {
            showStatus(
              "profileStatus",
              data.message || "í”„ë¡œí•„ ì´ë¯¸ì§€ ì„¤ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
              true
            );
          }
        } catch (error) {
          showStatus("profileStatus", "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", true);
        }
      }

      // 4. ì½”ì¸ ì°¾ê¸° ìœ í˜• ë¡œë“œ
      async function loadFinderTypes() {
        try {
          const response = await fetch("/api/coin-finder/types");
          const data = await response.json();

          if (data.success) {
            const container = document.getElementById("finderTypes");
            container.innerHTML = "";

            // ë‚˜ì˜ ì¥ì  ì½”ì¸
            data.data.myStrengthCoins.forEach((type) => {
              const card = document.createElement("div");
              card.className = "card";

              if (type.type === "EXPERIENCE_REFLECTION") {
                // ì‚¬ë¡€ ëŒì•„ë³´ê¸°ëŠ” ë³„ë„ í˜ì´ì§€ë¡œ ì´ë™
                card.innerHTML = `
                  <h3>${type.title}</h3>
                  <p>${type.description}</p>
                  <small style="color: #667eea; font-weight: 500;">${type.category}</small>
                `;
                card.addEventListener("click", () => {
                  window.location.href = "/situation-context-selection";
                });
              } else {
                card.innerHTML = `
                  <h3>${type.title}</h3>
                  <p>${type.description}</p>
                  <small style="color: #667eea; font-weight: 500;">${type.category}</small>
                `;
                card.addEventListener("click", () =>
                  selectFinderType(type, card)
                );
              }

              container.appendChild(card);
            });

            // ì¹œêµ¬ì˜ ì¥ì  ì½”ì¸ (ì¼ë‹¨ ë¹„í™œì„±í™”)
            data.data.friendStrengthCoins.forEach((type) => {
              const card = document.createElement("div");
              card.className = "card";
              card.style.opacity = "0.6";
              card.style.cursor = "not-allowed";
              card.innerHTML = `
                <h3>${type.title}</h3>
                <p>${type.description}</p>
                <small style="color: #999;">í˜„ì¬ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</small>
              `;
              container.appendChild(card);
            });
          }
        } catch (error) {
          showStatus(
            "finderStatus",
            "ì½”ì¸ ì°¾ê¸° ìœ í˜•ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
            true
          );
        }
      }

      function selectFinderType(type, element) {
        if (type.type !== "TODAY_DIARY") {
          showStatus(
            "finderStatus",
            'í˜„ì¬ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” "ì˜¤ëŠ˜ì˜ ì¼ê¸°"ë§Œ ì§€ì›í•©ë‹ˆë‹¤.',
            true
          );
          return;
        }

        document
          .querySelectorAll("#finderTypes .card")
          .forEach((card) => card.classList.remove("selected"));
        element.classList.add("selected");
        state.selectedFinderType = type;

        showStatus("finderStatus", "ì„ íƒì™„ë£Œ! ì˜¤ëŠ˜ì˜ ì¼ê¸°ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”.");
        setTimeout(() => {
          showStep("diaryStep");
        }, 1000);
      }

      // 5. ì¼ê¸° ì €ì¥
      async function saveDiary() {
        const content = document.getElementById("diaryContent").value.trim();
        if (!content) {
          showStatus("diaryStatus", "ì¼ê¸° ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", true);
          return;
        }

        showLoading("diaryStatus", "ì¼ê¸° ì €ì¥ ì¤‘...");

        try {
          const response = await fetch("/api/coin-finder/daily-diary", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ content }),
          });

          const data = await response.json();
          if (data.success) {
            state.formId = data.data.formId;
            showStatus(
              "diaryStatus",
              "ì¼ê¸°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ì½”ì¸ì„ ì„ íƒí•´ë³´ì„¸ìš”."
            );
            setTimeout(() => {
              loadCoins();
              showStep("coinSelectionStep");
            }, 1000);
          } else {
            showStatus(
              "diaryStatus",
              data.message || "ì¼ê¸° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
              true
            );
          }
        } catch (error) {
          showStatus("diaryStatus", "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", true);
        }
      }

      // 6. ì½”ì¸ ë° í‚¤ì›Œë“œ ë¡œë“œì™€ ì„ íƒ (ìƒˆë¡œìš´ UI)
      async function loadCoins() {
        showLoading("coinSelectionStatus", "ì¥ì  ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...");
        try {
          const response = await fetch("/api/coin-finder/selection-options");
          const data = await response.json();

          if (data.success && data.data && data.data.coins) {
            state.coinsWithKeywords = Object.values(data.data.coins);

            // 6ë‹¨ê³„ UIë¥¼ ìƒˆë¡œìš´ í˜•íƒœë¡œ ì—…ë°ì´íŠ¸
            const container = document.getElementById("coinSelectionStep");
            container.innerHTML = `
              <div class="step-title">
                <span class="step-number">6</span>
                ê·¸ë•Œ ì–´ë–¤ ì¥ì ì´ ë“œëŸ¬ë‚¬ë‚˜ìš”?
              </div>
              <p style="margin-bottom: 20px; color: #666;">ê°€ì¥ ë‹ë³´ì˜€ë‹¤ê³  ìƒê°í•˜ëŠ” ì¥ì  í•˜ë‚˜ë§Œ ê³¨ë¼ì£¼ì„¸ìš”.</p>
              
              <div id="coin-categories" class="categories"></div>
              <div id="keyword-grid" class="keyword-grid"></div>
              
              <div class="btn-group" style="margin-top: 20px">
                <button class="btn secondary" onclick="goToPreviousStep('coinSelectionStep')">ì´ì „</button>
                <button id="selectKeywordBtn" class="btn" onclick="goToNextStep()" disabled>ë‹¤ìŒ</button>
              </div>
              <div id="coinSelectionStatus" class="status" style="display: none"></div>
            `;

            // ì¹´í…Œê³ ë¦¬ íƒ­ ìƒì„±
            const categoriesContainer =
              document.getElementById("coin-categories");
            state.coinsWithKeywords.forEach((coin, index) => {
              const categoryBtn = document.createElement("button");
              categoryBtn.className = "category-btn";
              categoryBtn.textContent = coin.name;
              categoryBtn.onclick = () => selectCategory(coin, categoryBtn);
              categoriesContainer.appendChild(categoryBtn);

              // ì²« ë²ˆì§¸ ì¹´í…Œê³ ë¦¬ë¥¼ ê¸°ë³¸ ì„ íƒ
              if (index === 0) {
                setTimeout(() => categoryBtn.click(), 100);
              }
            });

            showStatus("coinSelectionStatus", "");
          } else {
            showStatus(
              "coinSelectionStatus",
              "ì½”ì¸ ì˜µì…˜ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: " + (data.message || ""),
              true
            );
          }
        } catch (error) {
          showStatus(
            "coinSelectionStatus",
            "ì½”ì¸ ì˜µì…˜ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
            true
          );
        }
      }

      function selectCategory(coin, btnElement) {
        // ì¹´í…Œê³ ë¦¬ íƒ­ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
        document
          .querySelectorAll(".category-btn")
          .forEach((btn) => btn.classList.remove("selected"));
        btnElement.classList.add("selected");

        state.selectedCoin = coin;
        state.selectedKeyword = null;
        document.getElementById("selectKeywordBtn").disabled = true;

        // í‚¤ì›Œë“œ ê·¸ë¦¬ë“œ ì—…ë°ì´íŠ¸
        const keywordGrid = document.getElementById("keyword-grid");
        keywordGrid.innerHTML = "";

        coin.keywords.forEach((keyword) => {
          const keywordCard = document.createElement("div");
          keywordCard.className = "keyword-card";
          keywordCard.textContent = keyword.name;
          keywordCard.onclick = () => selectKeyword(keyword, keywordCard);
          keywordGrid.appendChild(keywordCard);
        });
      }

      function selectKeyword(keyword, cardElement) {
        // í‚¤ì›Œë“œ ì¹´ë“œ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
        document
          .querySelectorAll(".keyword-card")
          .forEach((card) => card.classList.remove("selected"));
        cardElement.classList.add("selected");

        state.selectedKeyword = keyword;
        document.getElementById("selectKeywordBtn").disabled = false;
        showStatus(
          "coinSelectionStatus",
          `ì¥ì  "${keyword.name}"ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.`
        );
      }

      function goToNextStep() {
        if (!state.selectedKeyword) {
          showStatus("coinSelectionStatus", "ë¨¼ì € ì¥ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.", true);
          return;
        }

        // ì„ íƒëœ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ë‹¤ìŒ ë‹¨ê³„ë¡œ
        console.log(
          `ì„ íƒëœ ì½”ì¸: ${state.selectedCoin.name}, ì„ íƒëœ í‚¤ì›Œë“œ: ${state.selectedKeyword.name}`
        );

        // í‚¤ì›Œë“œ ì„ íƒ ë‹¨ê³„ëŠ” ê±´ë„ˆë›°ê³  ë°”ë¡œ ì¹´ë“œ ìƒì„±ìœ¼ë¡œ
        showStep("keywordSelectionStep");
        prepareCardCreation();
      }

      // ì¹´ë“œ ìƒì„± ì¤€ë¹„ í•¨ìˆ˜
      function prepareCardCreation() {
        const container = document.getElementById("keywordSelectionStep");
        container.innerHTML = `
          <div class="step-title">
            <span class="step-number">7</span>
            ì„ íƒí•œ ì¥ì ìœ¼ë¡œ ì¹´ë“œë¥¼ ë§Œë“¤ê¹Œìš”?
          </div>
          
          <div class="summary-box">
            <p><strong>ê²½í—˜:</strong> ${
              document.getElementById("diaryContent")
                ? document.getElementById("diaryContent").value
                : state.diaryEntry || "ì˜¤ëŠ˜ì˜ ì¼ê¸°"
            }</p>
            <p><strong>ì¥ì  ì¹´í…Œê³ ë¦¬:</strong> ${state.selectedCoin.name}</p>
            <p><strong>ê°€ì¥ ë¹›ë‚œ ì¥ì :</strong> ${
              state.selectedKeyword.name
            }</p>
          </div>
          
          <div class="btn-group" style="margin-top: 20px">
            <button class="btn secondary" onclick="goToPreviousStep('keywordSelectionStep')">ì´ì „</button>
            <button class="btn" onclick="createCard()">ë„¤, ë§Œë“¤ë˜ìš”</button>
          </div>
          <div id="keywordStatus" class="status" style="display: none"></div>
        `;
      }

      // 7. í‚¤ì›Œë“œ ë¡œë“œ ë° ì„ íƒ
      function loadKeywords() {
        if (!state.selectedCoin) return;

        const container = document.getElementById("keywordOptions");
        container.innerHTML = "";

        state.selectedCoin.keywords.forEach((keyword) => {
          const tag = document.createElement("div");
          tag.className = "keyword-tag";
          tag.textContent = keyword.name;
          tag.addEventListener("click", () => toggleKeyword(keyword, tag));
          container.appendChild(tag);
        });
      }

      function toggleKeyword(keyword, element) {
        if (state.selectedKeywords.has(keyword.id)) {
          state.selectedKeywords.delete(keyword.id);
          element.classList.remove("selected");
        } else {
          if (state.selectedKeywords.size < 3) {
            state.selectedKeywords.add(keyword.id);
            element.classList.add("selected");
          } else {
            showStatus(
              "keywordStatus",
              "ìµœëŒ€ 3ê°œì˜ í‚¤ì›Œë“œë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
              true
            );
            return;
          }
        }

        const selectedCount = state.selectedKeywords.size;
        document.getElementById("createCardBtn").disabled = selectedCount === 0;

        if (selectedCount > 0) {
          showStatus(
            "keywordStatus",
            `${selectedCount}ê°œì˜ í‚¤ì›Œë“œê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.`
          );
        }
      }

      // 8. ì¹´ë“œ ìƒì„±
      async function createCard() {
        if (!state.selectedKeyword) {
          showStatus("keywordStatus", "í‚¤ì›Œë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.", true);
          return;
        }

        showLoading("keywordStatus", "ì¹´ë“œ ìƒì„± ì¤‘...");

        try {
          const response = await fetch("/api/cards", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              formId: state.formId,
              coinId: state.selectedCoin.id,
              keywordIds: [state.selectedKeyword.id],
            }),
          });

          const result = await response.json();
          if (result.success) {
            state.createdCard = result.data;
            showCardComplete();
            showStep("completeStep");
          } else {
            showStatus(
              "keywordStatus",
              result.message || "ì¹´ë“œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
              true
            );
          }
        } catch (error) {
          showStatus("keywordStatus", "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", true);
        }
      }

      // ì™„ë£Œ ì •ë³´ í‘œì‹œ
      function showCardComplete() {
        const container = document.getElementById("finalCardInfo");

        container.innerHTML = `
          <div style="text-align: left;">
            <h2>ğŸ‰ ì¹´ë“œ ì™„ì„±!</h2>
            <p>ë‚˜ì˜ ê²½í—˜ì´ ë©‹ì§„ ì¹´ë“œë¡œ ë§Œë“¤ì–´ì¡Œì–´ìš”.</p>
            <div class="summary-box">
              <h3>${state.selectedCoin.name}</h3>
              <p><strong>${state.selectedKeyword.name}</strong></p>
              <p style="margin-top: 1rem; color: #555;">${
                document.getElementById("diaryContent")
                  ? document.getElementById("diaryContent").value
                  : state.diaryEntry || "ì˜¤ëŠ˜ì˜ ì¼ê¸°"
              }</p>
            </div>
            ${
              state.createdCard
                ? `<p>ìƒì„±ëœ ì¹´ë“œ ID: ${state.createdCard.id}</p>`
                : ""
            }
          </div>
        `;
      }

      // ë„¤ë¹„ê²Œì´ì…˜
      function goHome() {
        window.location.href = "/";
      }

      function restart() {
        // ìƒíƒœ ì´ˆê¸°í™”
        Object.keys(state).forEach((key) => {
          if (key === "selectedKeywords") {
            state[key] = new Set();
          } else if (typeof state[key] === "number") {
            state[key] =
              key === "currentStep" ? 1 : key === "totalSteps" ? 8 : null;
          } else {
            state[key] = null;
          }
        });

        // URL ì •ë¦¬
        window.history.replaceState(
          {},
          document.title,
          window.location.pathname
        );

        // ì²« ë²ˆì§¸ ë‹¨ê³„ë¡œ ì´ë™
        showStep("loginStep");

        // ëª¨ë“  ìƒíƒœ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
        document
          .querySelectorAll(".status")
          .forEach((el) => (el.style.display = "none"));

        // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
        document.getElementById("nickname").value = "";
        document.getElementById("diaryContent").value = "";
      }

      // ì´ˆê¸°í™”
      function initializeApp() {
        // URL íŒŒë¼ë¯¸í„° í™•ì¸
        const urlParams = new URLSearchParams(window.location.search);

        // ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ê²°ê³¼ ì²˜ë¦¬
        const loginSuccess = urlParams.get("login_success");
        if (loginSuccess === "true") {
          handleKakaoLoginResult(urlParams);
          return; // ë¡œê·¸ì¸ ì²˜ë¦¬ í›„ ì¢…ë£Œ
        }

        // ì‚¬ë¡€ ëŒì•„ë³´ê¸°ì—ì„œ ì˜¨ ê²½ìš° ì²˜ë¦¬
        const formId = urlParams.get("formId");
        const type = urlParams.get("type");
        const fromExperience = urlParams.get("from_experience");

        if (
          formId &&
          type === "EXPERIENCE_REFLECTION" &&
          fromExperience === "true"
        ) {
          // ì‚¬ë¡€ ëŒì•„ë³´ê¸°ì—ì„œ ì˜¨ ê²½ìš°
          state.formId = parseInt(formId);
          state.fromExperience = true;
          state.selectedFinderType = { type: "EXPERIENCE_REFLECTION" };

          // ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì´ í•„ìš”í•˜ë¯€ë¡œ ì²« ë²ˆì§¸ ë‹¨ê³„ë¶€í„° ì‹œì‘
          showStep("loginStep");

          // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
          showStatus(
            "loginStatus",
            "ì‚¬ë¡€ ëŒì•„ë³´ê¸°ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ì´ì œ ë¡œê·¸ì¸ í›„ ì¥ì ì„ ì„ íƒí•´ë³´ì„¸ìš”."
          );

          // ìë™ìœ¼ë¡œ ë‹¤ìŒ ë‹¨ê³„ë“¤ì„ ê±´ë„ˆë›°ê³  ì½”ì¸ ì„ íƒìœ¼ë¡œ ë°”ë¡œ ì´ë™í•  ìˆ˜ ìˆë„ë¡ ì¤€ë¹„
          state.skipToCoins = true;
        } else {
          // ì¼ë°˜ì ì¸ í”Œë¡œìš°
          showStep("loginStep");
        }

        updateProgress();
      }

      // ì•± ì´ˆê¸°í™” ì‹¤í–‰
      initializeApp();
    </script>
  </body>
</html>
